# 62. パスワードの安全な保存

## 生パスワード保存の危険性

パスワードを生（平文）のまま保存することは非常に危険である。

- データベースが漏洩した場合、全ユーザのパスワードが即座に第三者に知られる
- 他サービスで同じパスワードを使い回している場合、被害が連鎖的に拡大する
- 内部管理者や開発者がパスワードを閲覧できてしまう
- 一度漏洩すると取り消しや変更が困難である

そのため、生パスワードの保存は重大なセキュリティ事故につながる。

---

## ハッシュ化とは

ハッシュ化とは、元のデータから一方向に変換する処理であり、
ハッシュ値から元のパスワードを復元することはできない。

認証時は、入力されたパスワードを同じ方法でハッシュ化し、
保存されているハッシュ値と比較することで本人確認を行う。

---

## パスワードハッシュ化の意義

- データベースが漏洩しても、パスワードの復元が困難
- 管理者であってもユーザの実際のパスワードを知ることができない
- 総当たり攻撃や辞書攻撃への耐性を高められる

---

## 安全なハッシュ関数

パスワード保存には、計算コストが高く、ソルトを用いる
専用のハッシュ関数を使用する必要がある。

### 代表的な方式
- bcrypt
- scrypt
- pbkdf2

これらは以下の特徴を持つ。
- ソルトを自動的に付加し、同じパスワードでも異なるハッシュになる
- 計算に時間がかかるため、総当たり攻撃に強い

---

## bcryptの例

bcryptは現在広く利用されているパスワードハッシュ関数であり、
Node.js などのWebアプリケーションで標準的に使われている。

- ソルト込みでハッシュを生成
- コストパラメータにより安全性を調整可能
- 実装が容易で安全性が高い

---

## まとめ

- パスワードを生で保存してはいけない
- 必ず安全なハッシュ関数を用いて保存する
- bcrypt や scrypt などの専用アルゴリズムを利用することが重要である
